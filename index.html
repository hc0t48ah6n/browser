<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GASãƒ—ãƒ­ã‚­ã‚·ãƒ“ãƒ¥ãƒ¼ã‚¢ (ã‚·ãƒ³ãƒ—ãƒ«)</title>
    <!-- Tailwind CSSã‚’CDNã§èª­ã¿è¾¼ã¿ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=refresh" />
    <style>
        /* å…¨ç”»é¢è¡¨ç¤ºã¨ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’å¯èƒ½ã«ã™ã‚‹ãŸã‚ã®åŸºæœ¬è¨­å®š */
        body {
            /* ãƒšãƒ¼ã‚¸å…¨ä½“ã®ä½™ç™½ã‚’ãªãã—ã€iframeãŒç”»é¢ã®é«˜ã•ã‚’å ã‚ã‚‹ã‚ˆã†ã«ã™ã‚‹ */
            padding: 0;
            margin: 0;
            height: 100vh;
            overflow: hidden; /* bodyã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ç„¡åŠ¹åŒ– */
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
        }

        /* ------------------------------------------- */
        /* ã‚«ã‚¹ã‚¿ãƒ ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        /* ------------------------------------------- */
        .loader-tab {
            /* ã‚¿ãƒ–ã‚¢ã‚¤ã‚³ãƒ³ã‚µã‚¤ã‚º (w-4 h-4 = 16px) ã«åˆã‚ã›ã¦èª¿æ•´ */
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 3px solid #0000;
            border-right-color: #f97316; /* ã‚ªãƒ¬ãƒ³ã‚¸ */
            position: relative;
            animation: l24 1s infinite linear;
        }
        .loader-tab:before,
        .loader-tab:after {
            content: "";
            position: absolute;
            inset: -3px; /* borderå¹…ã¨åˆã‚ã›ã‚‹ */
            border-radius: 50%;
            border: inherit;
            animation: inherit;
            animation-duration: 2s;
            border-right-color: #f97316;
        }
        .loader-tab:after {
            animation-duration: 4s;
            border-right-color: #10b981; /* ã‚¨ãƒ¡ãƒ©ãƒ«ãƒ‰ */
        }
        @keyframes l24 {
            100% {transform: rotate(1turn)}
        }
        /* ------------------------------------------- */

        /* ã‚¹ã‚±ãƒƒãƒã«åˆã‚ã›ãŸã‚¿ãƒ–ã®ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ« */
        .tab-button {
            @apply flex items-center justify-between h-8 px-3 text-sm font-medium border-b-2 border-transparent transition-all duration-200 relative;
            /* ã‚¹ã‚±ãƒƒãƒã«åˆã‚ã›ã¦ã‚¿ãƒ–ã®è§’ã‚’ä¸¸ãã—ã€èƒŒæ™¯è‰²ã‚’è¨­å®š */
            background-color: #f3f4f6; /* gray-100 */
            border-top-left-radius: 6px;
            border-top-right-radius: 6px;
            min-width: 120px;
            max-width: 180px;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            margin-right: 2px;
            padding-right: 8px;
            flex-shrink: 0; /* ã‚¿ãƒ–ãŒç¸®ã¾ãªã„ã‚ˆã†ã« */
        }
        .tab-active {
            @apply bg-white border-b-2 border-emerald-500 text-gray-800 shadow-sm z-10;
        }
        .tab-inactive {
            @apply text-gray-600 hover:bg-gray-200;
        }
        .tab-title {
            /* ã‚¿ãƒ–åã¨ã‚¢ã‚¤ã‚³ãƒ³ã®æŠ˜ã‚Šè¿”ã—é˜²æ­¢ */
            @apply flex-grow overflow-hidden text-ellipsis whitespace-nowrap pr-2;
        }
        .tab-close-button {
            @apply ml-2 w-4 h-4 text-gray-500 hover:text-red-500 rounded-full flex items-center justify-center;
            flex-shrink: 0;
        }
        .new-tab-button {
            /* ã‚¿ãƒ–ãƒªã‚¹ãƒˆå†…ã«å«ã‚ã‚‹ãŸã‚ã€ã‚¿ãƒ–ã¨åŒã˜é«˜ã•ã¨ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨ */
            @apply h-8 w-8 flex items-center justify-center bg-gray-100 hover:bg-gray-200 border-b-2 border-gray-300 transition-colors duration-200;
            border-top-right-radius: 6px;
            flex-shrink: 0; /* ç¸®ã¾ãªã„ã‚ˆã†ã« */
        }

        /* ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒ–ãƒ©ã‚¦ã‚¶é¢¨ã®ã‚·ãƒ³ãƒ—ãƒ«ãªè¦‹ãŸç›®ã«èª¿æ•´ */
        .address-bar-icon {
            /* text-gray-500ã‚’æ˜ç¤ºçš„ã«è¿½åŠ ã—ã€ã‚¢ã‚¤ã‚³ãƒ³ã®è‰²ã‚’å®‰å®šã•ã›ã‚‹ */
            @apply absolute left-3 top-1/2 -translate-y-1/2 text-gray-500; 
        }
        .url-input {
            /* URLã¨Lockã‚¢ã‚¤ã‚³ãƒ³ã®æŠ˜ã‚Šè¿”ã—é˜²æ­¢ */
            @apply w-full h-full pl-10 pr-4 py-1.5 border-0 rounded-full focus:ring-emerald-500 focus:border-emerald-500 bg-gray-100 text-gray-800 shadow-inner;
        }
        /* ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ã‚³ãƒ³ãƒ†ãƒŠã®ä¿®æ­£ */
        .url-input-wrapper {
             /* flex-grow: 1.5ã§åºƒãã™ã‚‹ */
             @apply relative flex-grow flex-shrink min-w-0 overflow-x-hidden h-full;
             flex-grow: 1.5; 
        }

        /* ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ */
        .custom-scroll::-webkit-scrollbar {
            height: 8px; /* æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®é«˜ã• */
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background-color: #a0aec0; /* gray-400 */
            border-radius: 4px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background-color: #f7fafc; /* gray-50 */
        }
        
        /* è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .warning-message {
            @apply px-4 py-1 text-xs font-semibold bg-red-100 text-red-700 border-b border-red-300 transition-all duration-300;
        }
    </style>
    <style>
        /* ============ ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ ============ */n        :root{
            --bg:#0f172a; /* å¤œã®æµ·ã®ã‚ˆã†ãªãƒ€ãƒ¼ã‚¯ãƒ–ãƒ«ãƒ¼ */
            --panel:#0b1220;
            --muted:#94a3b8;
            --accent:#06b6d4; /* ã‚·ã‚¢ãƒ³ */
            --accent-2:#8b5cf6; /* ç´« */
            --glass: rgba(255,255,255,0.04);
            --glass-2: rgba(255,255,255,0.02);
            --radius:12px;
        }

        /* å…¨ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        html,body{
            height:100%;
            margin:0;
            padding:0;
            background: linear-gradient(180deg,var(--bg), #071029 80%);
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
            color: #e6eef8;
            -webkit-font-smoothing:antialiased;
            -moz-osx-font-smoothing:grayscale;
        }

        /* ã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã§æŸ”è»Ÿã«æ‰±ã† */
        body > *{box-sizing:border-box}
        .app-root{display:flex;flex-direction:column;height:100vh;gap:10px;padding:16px}

        /* ã‚¿ãƒ–ãƒãƒ¼ */
        .tabs-wrap{
            display:flex;align-items:center;gap:8px;
            background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            border-radius: calc(var(--radius) - 2px);
            padding:6px;box-shadow: 0 6px 20px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
            backdrop-filter: blur(6px) saturate(120%);
            border: 1px solid rgba(255,255,255,0.03);
        }

        .tabs-container{display:flex;align-items:end;gap:6px;overflow:auto;padding:2px 6px}
        .tabs-container::-webkit-scrollbar{height:8px}
        .tabs-container::-webkit-scrollbar-thumb{background:linear-gradient(90deg,var(--accent),var(--accent-2));border-radius:6px}

        .tab-button{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:10px 10px 6px 6px;min-width:140px;background:transparent;border:1px solid transparent;color:#000;font-weight:600;font-size:13px;cursor:pointer;transition: all 220ms cubic-bezier(.2,.9,.3,1);position:relative;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;}

        .tab-button .icon-wrap{display:inline-flex;align-items:center;justify-content:center;width:18px;height:18px;border-radius:6px}

        .tab-button.tab-active{
            color:#071133;background:linear-gradient(180deg,#ffffff 0%, #f7fbff 100%);font-weight:700;border:transparent;box-shadow:0 6px 20px rgba(11,20,30,0.6);
        }

        .tab-button.tab-active .icon-wrap{background:linear-gradient(135deg,var(--accent),var(--accent-2));color:white}
        .tab-button:not(.tab-active):hover{transform:translateY(-3px);background:var(--glass)}

        .tab-close-button{margin-left:auto;display:inline-flex;align-items:center;justify-content:center;width:26px;height:26px;border-radius:8px;border:0;background:transparent;color:var(--muted);}
        .tab-close-button:hover{background:rgba(255,255,255,0.03);color:#ff6b6b}

        /* æ–°è¦ã‚¿ãƒ–ãƒœã‚¿ãƒ³ */
        .new-tab-button{width:40px;height:36px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));display:flex;align-items:center;justify-content:center;border:1px dashed rgba(255,255,255,0.03);}
        .new-tab-button:hover{transform:translateY(-2px);box-shadow:0 6px 18px rgba(2,6,23,0.5)}

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ */
        .nav-bar{display:flex;align-items:center;gap:8px;padding:10px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;border:1px solid rgba(255,255,255,0.03);}
        .nav-buttons button{width:38px;height:38px;border-radius:9px;border:0;background:transparent;color:var(--muted);display:inline-flex;align-items:center;justify-content:center}
        .nav-buttons button:hover{background:var(--glass);color:#fff}

        .url-input-wrapper{flex:1;position:relative}
        .url-input{width:100%;height:32px;padding:6px 40px 6px 40px;border-radius:30px;border:1px solid rgba(255,255,255,0.04);background:#dff7ff;color:#000;outline:none;font-weight:600}
        .url-input:focus{box-shadow:0 6px 18px rgba(6,182,212,0.08), inset 0 1px 0 rgba(255,255,255,0.02);border:1px solid rgba(6,182,212,0.5)}

        .address-bar-icon{position:absolute;left:12px;top:50%;transform:translateY(-50%);pointer-events:none}
        .go-button{position:absolute;right:8px;top:50%;transform:translateY(-50%);width:36px;height:36px;border-radius:9px;border:0;background:linear-gradient(180deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;color:white;font-weight:700}

        /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ */
        .message-area{height:34px;padding:6px 12px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(255,255,255,0.00));color:var(--muted);display:flex;align-items:center}
        .warning-message{background:linear-gradient(90deg,#3b0d0d,#7f1d1d);color:#fff;font-weight:700}

        /* iframeã‚¨ãƒªã‚¢ */
        .frame-wrap{flex:1;border-radius:12px;overflow:hidden;border:1px solid rgba(255,255,255,0.03);box-shadow:0 30px 60px rgba(2,6,23,0.7);background:linear-gradient(180deg,#010612, #07102a)}
        iframe{width:100%;height:100%;border:0;background:white;display:block}

        /* ãƒ­ãƒ¼ãƒ€ãƒ¼ */
        .loader-tab{width:14px;height:14px;border-radius:999px;border:2px solid rgba(255,255,255,0.06);border-right-color:transparent;border-top-color:var(--accent);animation:spin 1s linear infinite}
        @keyframes spin{to{transform:rotate(1turn)}}

        /* å°ã•ãªãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–èª¿æ•´ */
        @media (max-width:800px){
            .tab-button{min-width:110px;font-size:12px}
            .url-input{height:40px}
        }

        /* ã‚¢ã‚¯ã‚»ã‚·ãƒ–ãƒ«ãªãƒ•ã‚©ãƒ¼ã‚«ã‚¹ */
        button:focus{outline:2px solid rgba(99,102,241,0.16);outline-offset:2px}
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
/* â˜… ã‚¿ãƒ–ä½œæˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãµã‚ã£ã¨å‡ºç¾ï¼‰ */
@keyframes tabCreateAnim {
  0% {
    transform: scale(0.6) translateY(8px);
    opacity: 0;
  }
  60% {
    transform: scale(1.05) translateY(0);
    opacity: 1;
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}

.tab-created {
  animation: tabCreateAnim 0.35s cubic-bezier(.2,1.2,.3,1) forwards;
}
</style>

<!-- â‘¡ Quicksand ã‚’ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ã«é©ç”¨ã™ã‚‹ãŸã‚ã®ä¸Šæ›¸ãCSSï¼ˆheadå†…ã®ä»–ã®ã‚¹ã‚¿ã‚¤ãƒ«ã®å¾Œã«ç½®ãã¨ç¢ºå®Ÿï¼‰ -->
<style>
  /* å¤‰æ•°ã§ä½¿ã„ã‚„ã™ã */
  :root {
    --ui-quicksand: 'Saira', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  }

  /* ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ï¼ˆURLå…¥åŠ›æ¬„ï¼‰ã« Quicksand ã‚’å¼·åˆ¶é©ç”¨ */
  .url-input,
  #addressBar,               /* ã‚‚ã—ç›´æ¥IDæŒ‡å®šãŒã‚ã‚Œã° */
  .url-input-wrapper,
  .address-bar-icon,
  .url-input::placeholder {
    font-family: var(--ui-quicksand) !important;
    font-weight: 600;        /* å¥½ã¿ã§ 400 / 500 / 600 / 700 ã‚’é¸ã‚“ã§ãã ã•ã„ */
    letter-spacing: 0.2px;   /* èª­ã¿ã‚„ã™ãã™ã‚‹å¾®èª¿æ•´ï¼ˆä»»æ„ï¼‰ */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  /* ã‚¿ãƒ–ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚‚åŒã˜ãƒ•ã‚©ãƒ³ãƒˆã«ã—ãŸã‘ã‚Œã° */
  .tab-title,
  .tab-button {
    font-family: var(--ui-quicksand) !important;
    font-weight: 600;
  }

  /* ã‚‚ã—æ—¢å­˜ã® .url-input ã® background/color ç­‰ã‚’å£Šã—ãŸããªã‘ã‚Œã°
     ãƒ•ã‚©ãƒ³ãƒˆé–¢é€£ã ã‘ä¸Šæ›¸ãã™ã‚‹ã‚ˆã†ã«ã—ã¦ãŠãã¨å®‰å…¨ã§ã™ã€‚ */
    .navbar {
  border-bottom: none;
}

.tab {
  padding: 12px 20px;
  border-bottom: 2px solid transparent; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ç·šã¯é€æ˜ */
  cursor: pointer;
}

.tab-button.active {
  border-bottom: none !important; /* â† é¸æŠä¸­ã‚¿ãƒ–ã¯ä¸‹ç·šãªã— */
  margin-bottom: -2px;            /* â† ä¸‹ã« 2px å¼•ãä¸Šã’ã¦å®Œå…¨ã«å¯†ç€ï¼ */
}

    .tabs {
  position: relative;
  display: flex;
  background: #ffffffaa;
  backdrop-filter: blur(10px);
  padding: 6px;
  border-radius: 14px;
  gap: 6px;
}

.tabs input {
  display: none;
}

.tab {
  padding: 10px 20px;
  border-radius: 10px;
  cursor: pointer;
  font-size: 16px;
  position: relative;
  z-index: 2;
  transition: 0.25s ease;
}

.tab:hover {
  transform: translateY(-2px);
}

/* é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
input:checked + .tab {
  font-weight: 600;
  color: #4f46e5;
}

/* ä¸‹ç·šï¼ˆã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ï¼‰ */
.indicator {
  position: absolute;
  bottom: 6px;
  height: 3px;
  background: #4f46e5;
  border-radius: 3px;
  transition: 0.25s ease;
}

/* ã‚¿ãƒ–ä½ç½®ã«å¿œã˜ã¦ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’ç§»å‹• */
#tab1:checked ~ .indicator {
  left: 6px;
  width: 78px;
}

#tab2:checked ~ .indicator {
  left: 90px;
  width: 78px;
}

#tab3:checked ~ .indicator {
  left: 174px;
  width: 78px;
}

</style>
</head>
<body class="bg-gray-100 flex flex-col">

    <!-- ãƒ–ãƒ©ã‚¦ã‚¶æœ¬ä½“ã®UI (å¤–æ ã‚„èƒŒæ™¯ã‚’æ’é™¤) -->
    <div class="w-full flex-shrink-0">
        <!-- ã‚¿ãƒ–ã¨æ–°è¦ã‚¿ãƒ–ãƒœã‚¿ãƒ³ -->
        <div class="flex border-b border-gray-300 bg-gray-200">
            <div id="tabsContainer" class="flex overflow-x-auto custom-scroll flex-grow items-end">
                <!-- æ–°è¦ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒŠã®æœ€å¾Œã«ç§»å‹• -->
                <button id="newTabButton" class="new-tab-button">
                    <!-- Heroicons Plus Icon --><svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                </button>
            </div>
        </div>

        <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ (æˆ»ã‚‹/é€²ã‚€/æ›´æ–°/ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼) -->
        <div class="flex items-center p-2 border-b border-gray-300 space-x-2 bg-white h-12">
            <button id="backButton" class="p-1 rounded-full hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed">
                <!-- Heroicons Chevron Left --><svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
            </button>
            <button id="forwardButton" class="p-1 rounded-full hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed">
                <!-- Heroicons Chevron Right --><svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
            </button>
            
            <button id="refreshButton" class="p-1 rounded-full hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed">
                <!-- Heroicons Arrow Path (Rotate) -->
         <span class="material-symbols-outlined" style="color: black; position: relative; top: 4px;">
refresh
</span>
                 
              
            </button>

            <!-- ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ -->
            <div id="urlInputWrapper" class="url-input-wrapper">
                <!-- ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤ºã‚’å‹•çš„ã«æ›´æ–°ã—ã¾ã™ -->
                <span id="addressBarIcon" class="address-bar-icon">
                     <!-- åˆæœŸãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼: åœ°çƒå„€ã‚¢ã‚¤ã‚³ãƒ³ -->
                    <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 0110 5.8a18.024 18.024 0 018.9 4.35M18 10a8 8 0 11-16 0 8 8 0 0116 0z"></path></svg>
                </span>
                <input type="url" id="addressBar" placeholder="URLã‚’å…¥åŠ›ã—ã¦Enter" value="https://example.com"
                       class="url-input">
            </div>
            
            <!-- æ¤œç´¢ãƒœã‚¿ãƒ³ (ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ã¨ä¸€ä½“åŒ–ã®ãŸã‚ã€ã‚¢ã‚¤ã‚³ãƒ³ã®ã¿) -->
            <button id="goButton" class="p-1 rounded-full hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed">
                <!-- Heroicons Arrow Right -->
                <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
            </button>
        </div>
        <div id="fullscreenToggle">å…¨ç”»é¢</div>
    </div>

    <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ (ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼é¢¨) -->
    <!-- è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
    <div id="messageArea" class="flex-shrink-0 px-4 py-1 text-xs text-gray-700 bg-gray-50 border-b border-gray-200">
        æ–°ã—ã„ã‚¿ãƒ–ã‚’é–‹ã„ã¦URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
    </div>

    <!-- iframeã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºã‚¨ãƒªã‚¢ (æ®‹ã‚Šã®ã™ã¹ã¦ã®é«˜ã•ã‚’å ã‚ã‚‹) -->
    <iframe id="renderedFrame"
            class="w-full flex-grow bg-white border-none" allowfullscreen>
    </iframe>
    <!-- ä»¥ä¸‹ã¯ "ã‚¿ãƒ–ãƒãƒ¼ã‚’æ¶ˆã—ã¦å®Œå…¨ãªå…¨ç”»é¢è¡¨ç¤ºã«åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹æ©Ÿèƒ½" ã‚’è¿½åŠ ã—ãŸãƒ‘ãƒƒãƒã‚³ãƒ¼ãƒ‰ã§ã™ -->

<!-- â˜… è¿½åŠ ã™ã‚‹CSSï¼ˆå…¨ç”»é¢ãƒ¢ãƒ¼ãƒ‰ç”¨ï¼‰ -->
<style>
  .fullscreen iframe {
    height: 100vh !important;
  }
  .fullscreen #tabsContainer,
  .fullscreen .nav-bar,
  .fullscreen .message-area,
  .fullscreen .border-b,
  .fullscreen .h-12,
  .fullscreen [class*="tab"] {
    display: none !important;
  }

  /* å³ä¸Šã«è¡¨ç¤ºã™ã‚‹ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³åˆ‡æ›¿ãƒœã‚¿ãƒ³ */
  #fullscreenToggle {
    position: fixed;
    top: 10px;
    right: 10px;
    z-index: 99999;
    background: rgba(0,0,0,0.5);
    color: #fff;
    border-radius: 8px;
    padding: 6px 12px;
    cursor: pointer;
    font-size: 14px;
    backdrop-filter: blur(4px);
  }
  #fullscreenToggle:hover {
    background: rgba(0,0,0,0.7);
  }
</style>

<!-- â˜… HTML ã«è¿½åŠ ï¼ˆbody å†…ã®ã©ã“ã§ã‚‚OKã€‚æ¨å¥¨ã¯bodyä¸Šï¼‰ -->


<!-- â˜… JavaScriptï¼ˆæœ€ä¸‹éƒ¨ã® script å†…ã«è¿½åŠ ï¼‰ -->
<script>
  const fsBtn = document.getElementById("fullscreenToggle");

  fsBtn.addEventListener("click", () => {
    document.body.classList.toggle("fullscreen");

    // è¡¨ç¤ºãƒ†ã‚­ã‚¹ãƒˆåˆ‡ã‚Šæ›¿ãˆ
    if (document.body.classList.contains("fullscreen")) {
      fsBtn.textContent = "æˆ»ã‚‹";
    } else {
      fsBtn.textContent = "å…¨ç”»é¢";
    }
  });
</script>
    <script>
        // â–¼ ã‚¿ãƒ–ã®ãƒ•ã‚¡ãƒ“ã‚³ãƒ³å–å¾—ï¼†è¡¨ç¤ºæ©Ÿèƒ½
async function fetchFavicon(url) {
    try {
        const u = new URL(url);
        return u.origin + "/favicon.ico";
    } catch {
        return null;
    }
}
function boldMainDomain(url) {
    try {
        const u = new URL(url);

        // ä¾‹: fonts.google.com â†’ google.com ã‚’æŠ½å‡º
        const parts = u.hostname.split(".");
        let mainDomain = parts.slice(-2).join(".");

        // URLã‚’ hostname éƒ¨åˆ†ã§åˆ†å‰²ã—ã¦å¤ªå­—åŒ–
        const bolded = url.replace(mainDomain, `<strong>${mainDomain}</strong>`);

        return bolded;
    } catch {
        return url; // URLã¨ã—ã¦ä¸æ­£ãªã‚‰ãã®ã¾ã¾è¿”ã™
    }
}

        function updateAddressBarText(url) {
    const ab = document.getElementById("addressBar");
    ab.innerHTML = boldMainDomain(url);
}

        
// â–¼ ãƒ­ãƒƒã‚¯ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰è¨¼æ˜æ›¸ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
const lockIcon = document.getElementById('addressBarIcon');
const certModal = document.getElementById('certModal');
const certInfo = document.getElementById('certInfo');
const closeCert = document.getElementById('closeCert');

lockIcon.style.cursor = 'pointer';

lockIcon.onclick = async () => {
    const url = document.getElementById('addressBar').value;
    certInfo.textContent = "å–å¾—ä¸­â€¦";
    certModal.style.display = 'flex';

    try {
        const response = await fetch(url, { method: 'GET' });
        const headers = [...response.headers.entries()] 
            .map(h => h[0] + ': ' + h[1])
            .join("\n");

        certInfo.textContent =
            "ğŸ” ã“ã®ãƒšãƒ¼ã‚¸ã®è¨¼æ˜æ›¸æƒ…å ± (ãƒ˜ãƒƒãƒ€ãƒ¼)\n-------------------------------------\n" + headers;

    } catch (e) {
        certInfo.textContent = "è¨¼æ˜æ›¸æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚\nãƒ­ãƒ¼ã‚«ãƒ«ãƒšãƒ¼ã‚¸ã‚„CORSåˆ¶é™ãŒåŸå› ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚";
    }
};

closeCert.onclick = () => {
    certModal.style.display = 'none';
};
        /* ã“ã“ã‹ã‚‰å…ˆã¯å…ƒã® brow.html ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ãã®ã¾ã¾è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚
           ã‚¹ã‚¿ã‚¤ãƒ«ã ã‘ã‚’æ”¹å–„ã™ã‚‹ãŸã‚ã«ã‚³ãƒ¼ãƒ‰ã®ãƒ­ã‚¸ãƒƒã‚¯ã¯å¤‰æ›´ã—ã¦ã„ã¾ã›ã‚“ã€‚
           ã‚‚ã—ã‚¹ã‚¯ãƒªãƒ—ãƒˆã”ã¨æ›´æ–°ã‚’å¸Œæœ›ã§ã‚ã‚Œã°ã€ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«å†…ã§ç½®ãæ›ãˆã¾ã™ã€‚ */
    </script>
    <!-- â–¼ è¨¼æ˜æ›¸ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="certModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); backdrop-filter:blur(4px); z-index:9999; align-items:center; justify-content:center;">
        <div style="background:#fff; color:#000; width:90%; max-width:480px; border-radius:14px; padding:20px; box-shadow:0 10px 30px rgba(0,0,0,0.4);">
            <h2 style="font-size:18px; font-weight:700; margin-bottom:10px;">è¨¼æ˜æ›¸æƒ…å ±</h2>
            <pre id="certInfo" style="white-space:pre-wrap; background:#f3f3f3; padding:10px; border-radius:10px; max-height:300px; overflow:auto; font-size:13px;"></pre>
            <button id="closeCert" style="margin-top:12px; background:#0ea5e9; color:#fff; padding:8px 16px; border-radius:10px;">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <script>
        // ====================================================================
        // GASã®URLã¯è¨­å®šæ¸ˆã¿ã®ã‚‚ã®ã‚’ä½¿ç”¨ã—ã¾ã™
        // ====================================================================
        const GAS_URL = "https://script.google.com/macros/s/AKfycbwubZBZJY-AfSGzPKVFRuFXmdfj2pFKFIStji-uMF2iAUuwfDclCRmhsMtkhjNKO1dg/exec"; 
        
        // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        const SECURITY_WARNING = 'ã“ã®ãƒšãƒ¼ã‚¸ã¯ä¿è­·ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚å€‹äººæƒ…å ±ã‚„ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰æƒ…å ±ã‚’å…¥åŠ›ã—ãªã„ã§ãã ã•ã„ã€‚';

        // çŠ¶æ…‹ç®¡ç†
        let tabs = [];
        let currentTabIndex = -1; // ç¾åœ¨é¸æŠã•ã‚Œã¦ã„ã‚‹ã‚¿ãƒ–ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹

        // UIã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆã®å–å¾—
        const tabsContainer = document.getElementById('tabsContainer');
        const newTabButton = document.getElementById('newTabButton'); 
        const backButton = document.getElementById('backButton');
        const forwardButton = document.getElementById('forwardButton');
        const refreshButton = document.getElementById('refreshButton');
        const addressBar = document.getElementById('addressBar');
        const goButton = document.getElementById('goButton');
        const messageArea = document.getElementById('messageArea');
        const renderedFrame = document.getElementById('renderedFrame'); // iframeè¦ç´ 
        const addressBarIconSpan = document.getElementById('addressBarIcon');

        // ====================================================================
        // GAS URLã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¨åˆæœŸåŒ–
        // ====================================================================
        if (GAS_URL.includes('ã“ã“ã«ã‚³ãƒ”ãƒ¼ã—ãŸGASã®URLã‚’è²¼ã‚Šä»˜ã‘ã‚‹')) {
            newTabButton.disabled = true;
            backButton.disabled = true;
            forwardButton.disabled = true;
            refreshButton.disabled = true;
            addressBar.disabled = true;
            goButton.disabled = true;
            messageArea.textContent = 'ã‚¨ãƒ©ãƒ¼: GASã®URLãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã‚³ãƒ¼ãƒ‰å†…ã®å¤‰æ•°ã‚’ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚';
        } else {
            newTabButton.disabled = false;
            addressBar.disabled = false;
            goButton.disabled = false;
        }

        // ====================================================================
        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        // ====================================================================
        newTabButton.addEventListener('click', () => addTab('https://example.com'));
        goButton.addEventListener('click', () => navigateToUrl(addressBar.value));
        addressBar.addEventListener('keypress', (e) => { 
            if (e.key === 'Enter') {
                navigateToUrl(addressBar.value);
            }
        });
        backButton.addEventListener('click', () => navigateHistory(-1));
        forwardButton.addEventListener('click', () => navigateHistory(1));
        refreshButton.addEventListener('click', () => refreshCurrentTab());

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¿ãƒ–ã‚’ä½œæˆ
        document.addEventListener('DOMContentLoaded', () => {
            if (tabs.length === 0 && !newTabButton.disabled) {
                addTab(addressBar.value || 'https://example.com');
                updateAddressBarIcon(addressBar.value || 'https://example.com');
                updateSecurityMessage(addressBar.value || 'https://example.com');
            }
        });

        // ====================================================================
        // ã‚¿ãƒ–ã¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚³ã‚¢æ©Ÿèƒ½
        // ====================================================================

        /**
         * æ–°ã—ã„ã‚¿ãƒ–ã‚’è¿½åŠ ã—ã€æŒ‡å®šã•ã‚ŒãŸURLã‚’èª­ã¿è¾¼ã‚€
         * @param {string} url - èª­ã¿è¾¼ã‚€URL
         */
        function addTab(url) {
            const newTab = {
                id: Date.now(), 
                url: url, // ãƒªã‚¯ã‚¨ã‚¹ãƒˆURL (å±¥æ­´ç”¨)
                content: '',
                title: 'èª­ã¿è¾¼ã¿ä¸­...',
                favicon: '', 
                isLoading: true,
                history: [url],
                historyIndex: 0,
                displayUrl: url // ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ã«è¡¨ç¤ºã™ã‚‹ã‚ªãƒªã‚¸ãƒ³URL
            };
            tabs.push(newTab);
            currentTabIndex = tabs.length - 1;
            renderTabs();
            switchTab(currentTabIndex);
            fetchAndRenderInTab(currentTabIndex, url);
        }

        /**
         * ã‚¿ãƒ–ã‚’é–‰ã˜ã‚‹
         * @param {number} indexToClose - é–‰ã˜ã‚‹ã‚¿ãƒ–ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
         */
        function closeTab(indexToClose) {
            if (tabs.length <= 1) return; 

            tabs.splice(indexToClose, 1); 

            if (indexToClose === currentTabIndex) {
                currentTabIndex = Math.min(indexToClose, tabs.length - 1);
            } else if (indexToClose < currentTabIndex) {
                currentTabIndex--;
            }
            
            renderTabs();
            if (tabs.length > 0) {
                switchTab(currentTabIndex); 
            } else {
                renderIframeContent({ content: '<body style="padding: 20px; font-family: sans-serif; text-align: center;"><h1>æ–°ã—ã„ã‚¿ãƒ–ã‚’é–‹ã„ã¦ãã ã•ã„</h1></body>' });
                addressBar.value = '';
                updateNavigationButtons();
                updateAddressBarIcon(''); 
                updateSecurityMessage(''); // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢
            }
            messageArea.textContent = `ã‚¿ãƒ–ã‚’é–‰ã˜ã¾ã—ãŸã€‚`;
        }
(function(){
    const originalCreateTab = window.createTab;
    if (!originalCreateTab) return;

    window.createTab = async function(url){
        const tab = originalCreateTab(url);
        const faviconUrl = await fetchFavicon(url);

        const iconWrap = tab.querySelector('.icon-wrap');
        if (iconWrap && faviconUrl) {
            iconWrap.innerHTML = `<img src="${faviconUrl}" style="width:16px;height:16px;border-radius:4px;">`;
        }
        return tab;
    };
})();

        (async function(){
    const goButton = document.getElementById('goButton');
    const addressBar = document.getElementById('addressBar');

    async function updateFaviconForActiveTab(){
        const url = addressBar.value;
        const faviconUrl = await fetchFavicon(url);

        const activeTab = document.querySelector('.tab-button.tab-active .icon-wrap');
        if (activeTab && faviconUrl) {
            activeTab.innerHTML = `<img src="${faviconUrl}" style="width:16px;height:16px;border-radius:4px;">`;
        }
    }

    goButton?.addEventListener('click', updateFaviconForActiveTab);
    addressBar?.addEventListener('keydown', e=>{
        if (e.key === 'Enter') updateFaviconForActiveTab();
    });
})();


        /**
         * ã‚¿ãƒ–ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã€ç¾åœ¨ã®ã‚¿ãƒ–ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆã™ã‚‹
         */
        function renderTabs() {
            const newTabButtonRef = tabsContainer.querySelector('#newTabButton');
            tabsContainer.innerHTML = '';
            
            tabs.forEach((tab, index) => {
                const isActive = index === currentTabIndex;
                const tabTitle = tab.title.length > 20 ? tab.title.substring(0, 17) + '...' : tab.title;

                const button = document.createElement('button');
                button.className = `tab-button ${isActive ? 'tab-active' : 'tab-inactive'}`;
                button.setAttribute('data-index', index);
                
                const iconSpan = document.createElement('span');
                iconSpan.className = 'mr-1 w-4 h-4 flex items-center justify-center';
                
                if (tab.isLoading) {
                    iconSpan.innerHTML = '<div class="loader-tab"></div>';
                } else if (tab.favicon) {
                    iconSpan.innerHTML = `<img src="${tab.favicon}" alt="Favicon" class="w-4 h-4 object-contain" onerror="this.onerror=null; this.src='data:image/svg+xml;utf8,<svg xmlns=\\'http://www.w3.org/2000/svg\\' viewBox=\\'0 0 24 24\\' fill=\\'none\\' stroke=\\'currentColor\\' stroke-width=\\'2\\' stroke-linecap=\\'round\\' stroke-linejoin=\\'round\\'><circle cx=\\'12\\' cy=\\'12\\' r=\\'10\\'/></svg>';" />`;
                } else {
                     iconSpan.innerHTML = `
                        <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18m-9-4v8m-7 4h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                    `;
                }
                
                button.appendChild(iconSpan);

                const titleSpan = document.createElement('span');
                titleSpan.className = 'tab-title';
                titleSpan.textContent = tabTitle;
                button.appendChild(titleSpan);

                if (tabs.length > 0) { 
                    const closeBtn = document.createElement('button');
                    closeBtn.className = 'tab-close-button';
                    closeBtn.innerHTML = `
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    `;
                    closeBtn.onclick = (e) => {
                        e.stopPropagation(); 
                        closeTab(index);
                    };
                    button.appendChild(closeBtn);
                }
                
                button.onclick = () => switchTab(index);
                tabsContainer.appendChild(button);
            });
            
            if (newTabButtonRef) {
                 tabsContainer.appendChild(newTabButtonRef);
            }
            
            tabsContainer.scrollTo({ left: tabsContainer.scrollWidth, behavior: 'smooth' });
            // â˜… ä½œæˆã•ã‚ŒãŸã‚¿ãƒ–ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä»˜ä¸
setTimeout(() => {
    const lastTab = tabsContainer.querySelector('.tab-button:last-child');
    if (lastTab) {
        lastTab.classList.add('tab-created');
    }
}, 10);

        }


        /**
         * ã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
         * @param {number} index - åˆ‡ã‚Šæ›¿ãˆã‚‹ã‚¿ãƒ–ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
         */
        function switchTab(index) {
            if (currentTabIndex === index || index < 0 || index >= tabs.length) return;
            currentTabIndex = index;
            renderTabs();
            const currentTab = tabs[currentTabIndex];
            renderIframeContent(currentTab);
            
            // ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ã€ã‚¢ã‚¤ã‚³ãƒ³ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ›´æ–°
            addressBar.value = currentTab.displayUrl; 
            updateAddressBarIcon(currentTab.displayUrl);
            updateSecurityMessage(currentTab.displayUrl, currentTab.isLoading);
            
            updateNavigationButtons();
        }

        /**
         * ç¾åœ¨ã®ã‚¿ãƒ–ã®URLã«ç§»å‹•ã™ã‚‹
         * @param {string} url - ç§»å‹•å…ˆã®URL
         * @param {boolean} [addToHistory=true] - å±¥æ­´ã«è¿½åŠ ã™ã‚‹ã‹ã©ã†ã‹
         */
        function navigateToUrl(url, addToHistory = true) {
            if (!tabs[currentTabIndex]) {
                addTab(url);
                return;
            }

            const currentTab = tabs[currentTabIndex];
            let validatedUrl = url.trim(); // å‰å¾Œã®ç©ºç™½ã‚’å‰Šé™¤

            // 1. ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒã‚§ãƒƒã‚¯
            const hasProtocol = validatedUrl.startsWith('http://') || validatedUrl.startsWith('https://');

            if (!hasProtocol) {
                // 2. æ¤œç´¢ã‚¯ã‚¨ãƒªåˆ¤å®š:
                //    - ã‚¹ãƒšãƒ¼ã‚¹ãŒå«ã¾ã‚Œã¦ã„ã‚‹ (è¤‡æ•°èªã®æ¤œç´¢)
                //    - ã¾ãŸã¯ã€ãƒ‰ãƒƒãƒˆãŒå«ã¾ã‚Œã¦ã„ãªã„ (ãƒ‰ãƒ¡ã‚¤ãƒ³å½¢å¼ã§ãªã„)
                const isSearchQuery = validatedUrl.includes(' ') || !validatedUrl.includes('.');
                
                if (isSearchQuery) {
                    // Googleæ¤œç´¢ã®URLã‚’æ§‹ç¯‰
                    validatedUrl = `https://www.google.com/search?q=${encodeURIComponent(validatedUrl)}`;
                } else {
                    // ãƒ‰ãƒ¡ã‚¤ãƒ³å½¢å¼ã¨è¦‹ãªã—ã¦ https:// ã‚’è¿½åŠ 
                    validatedUrl = 'https://' + validatedUrl;
                }
            }
            
            if (addToHistory) {
                currentTab.history = currentTab.history.slice(0, currentTab.historyIndex + 1);
                currentTab.history.push(validatedUrl);
                currentTab.historyIndex = currentTab.history.length - 1;
            } else {
                currentTab.history[currentTab.historyIndex] = validatedUrl; 
            }

            // èª­ã¿è¾¼ã¿é–‹å§‹æ™‚ã€ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ã«ã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ãŸURLã‚’è¡¨ç¤º
            addressBar.value = validatedUrl; 
            updateAddressBarIcon(validatedUrl);
            updateSecurityMessage(validatedUrl, true);
            
            fetchAndRenderInTab(currentTabIndex, validatedUrl);
            updateNavigationButtons();
        }

        /**
         * å±¥æ­´ã‚’å‰å¾Œã«ç§»å‹•ã™ã‚‹
         * @param {number} delta - -1ã§æˆ»ã‚‹ã€1ã§é€²ã‚€
         */
        function navigateHistory(delta) {
            if (!tabs[currentTabIndex]) return;

            const currentTab = tabs[currentTabIndex];
            const newIndex = currentTab.historyIndex + delta;

            if (newIndex >= 0 && newIndex < currentTab.history.length) {
                currentTab.historyIndex = newIndex;
                navigateToUrl(currentTab.history[newIndex], false); 
            }
        }

        /**
         * ç¾åœ¨ã®ã‚¿ãƒ–ã‚’æ›´æ–°ã™ã‚‹
         */
        function refreshCurrentTab() {
            if (!tabs[currentTabIndex]) return;
            const currentTab = tabs[currentTabIndex];
            navigateToUrl(currentTab.url, false); 
        }

        /**
         * æˆ»ã‚‹/é€²ã‚€ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’æ›´æ–°ã™ã‚‹
         */
        function updateNavigationButtons() {
            if (!tabs[currentTabIndex]) {
                backButton.disabled = true;
                forwardButton.disabled = true;
                refreshButton.disabled = true;
                return;
            }
            const currentTab = tabs[currentTabIndex];
            backButton.disabled = currentTab.historyIndex === 0;
            forwardButton.disabled = currentTab.historyIndex === currentTab.history.length - 1;
            refreshButton.disabled = false;
        }

        /**
         * ğŸŒŸ ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’URLã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«å¿œã˜ã¦æ›´æ–°ã™ã‚‹
         * @param {string} url - ç¾åœ¨ã®URL (displayUrl)
         */
        function updateAddressBarIcon(url) {
            let iconSvg = '';

            try {
                const parsedUrl = new URL(url);
                if (parsedUrl.protocol === 'https:') {
                    // ã‚»ã‚­ãƒ¥ã‚¢ (HTTPS) - ã‚¨ãƒ¡ãƒ©ãƒ«ãƒ‰ã‚°ãƒªãƒ¼ãƒ³ã®éµã‚¢ã‚¤ã‚³ãƒ³
                    iconSvg = `
                        <svg class="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
                    `;
                } else if (parsedUrl.protocol === 'http:') {
                    // éã‚»ã‚­ãƒ¥ã‚¢ (HTTP) - èµ¤ã„æ„Ÿå˜†ç¬¦ã‚¢ã‚¤ã‚³ãƒ³ (è­¦å‘Š)
                    iconSvg = `
                         <svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                    `;
                } else {
                    // ãã®ä»–/åˆæœŸçŠ¶æ…‹ - ã‚°ãƒ¬ãƒ¼ã®åœ°çƒå„€ã‚¢ã‚¤ã‚³ãƒ³
                    iconSvg = `
                        <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 0110 5.8a18.024 18.024 0 018.9 4.35M18 10a8 8 0 11-16 0 8 8 0 0116 0z"></path></svg>
                    `;
                }
            } catch (e) {
                // URLãŒç„¡åŠ¹ãªå ´åˆã‚‚åœ°çƒå„€ã‚¢ã‚¤ã‚³ãƒ³
                iconSvg = `
                    <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 0110 5.8a18.024 18.024 0 018.9 4.35M18 10a8 8 0 11-16 0 8 8 0 0116 0z"></path></svg>
                `;
            }

            addressBarIconSpan.innerHTML = iconSvg;
        }

        /**
         * ğŸŒŸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º/éè¡¨ç¤ºã«ã™ã‚‹
         * @param {string} url - ç¾åœ¨ã®URL (displayUrl)
         * @param {boolean} isLoading - èª­ã¿è¾¼ã¿ä¸­ã‹ã©ã†ã‹
         */
        function updateSecurityMessage(url, isLoading = false) {
            // èª­ã¿è¾¼ã¿ä¸­ã¯ä½•ã‚‚è¡¨ç¤ºã—ãªã„
            if (isLoading) {
                messageArea.className = 'flex-shrink-0 px-4 py-1 text-xs text-gray-700 bg-gray-50 border-b border-gray-200';
                messageArea.textContent = `ã‚¿ãƒ– ${currentTabIndex + 1} ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’èª­ã¿è¾¼ã¿ä¸­...`;
                return;
            }
            
            try {
                const parsedUrl = new URL(url);
                if (parsedUrl.protocol === 'http:') {
                    // HTTPã®å ´åˆã€è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                    messageArea.className = 'flex-shrink-0 warning-message';
                    messageArea.textContent = SECURITY_WARNING;
                } else {
                    // HTTPSã¾ãŸã¯ãã®ä»–ã®å ´åˆã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¾ãŸã¯ç©ºã«ã™ã‚‹
                    messageArea.className = 'flex-shrink-0 px-4 py-1 text-xs text-gray-700 bg-gray-50 border-b border-gray-200';
                    messageArea.textContent = ''; // æˆåŠŸæ™‚ã¯ç©ºã«ã™ã‚‹
                }
            } catch (e) {
                // URLãŒç„¡åŠ¹ãªå ´åˆ
                messageArea.className = 'flex-shrink-0 px-4 py-1 text-xs text-gray-700 bg-gray-50 border-b border-gray-200';
                messageArea.textContent = 'URLã‚’å…¥åŠ›ã—ã¦Enterã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚';
            }
        }


        /**
         * iframeã«ç‰¹å®šã®ã‚¿ãƒ–ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤ºã™ã‚‹
         * @param {object} tab - è¡¨ç¤ºã™ã‚‹ã‚¿ãƒ–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
         */
        function renderIframeContent(tab) {
             const doc = renderedFrame.contentWindow.document;
             doc.open();
             
             if (tab.content) {
                 doc.write(tab.content);
             } else {
                 if (!tab.isLoading) {
                    const statusText = 'ã‚¨ãƒ©ãƒ¼ã¾ãŸã¯æœªå–å¾—ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„';
                    doc.write(`<body style="padding: 20px; font-family: sans-serif; text-align: center; color: #6b7280;"><h1>${statusText}</h1></body>`);
                 } else {
                    doc.write('<body></body>'); 
                 }
             }
             doc.close();
        }

        /**
         * GASçµŒç”±ã§HTMLã‚’å–å¾—ã—ã€ç‰¹å®šã®ã‚¿ãƒ–ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹
         * @param {number} index - å¯¾è±¡ã‚¿ãƒ–ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
         * @param {string} url - å–å¾—ã™ã‚‹URL
         */
        async function fetchAndRenderInTab(index, url) {
            const currentTab = tabs[index];
            if (!currentTab) return;

            currentTab.isLoading = true;
            currentTab.url = url; 
            currentTab.title = 'èª­ã¿è¾¼ã¿ä¸­...';
            currentTab.favicon = '';
            
            // èª­ã¿è¾¼ã¿é–‹å§‹æ™‚ã€ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ã«ã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ãŸURLã‚’è¡¨ç¤º
            currentTab.displayUrl = url;
            if (index === currentTabIndex) {
                addressBar.value = url;
                updateAddressBarIcon(url);
                updateSecurityMessage(url, true);
            }
            
            renderTabs(); 

            if (index === currentTabIndex) {
                 goButton.disabled = true;
                 addressBar.disabled = true;
                 refreshButton.disabled = true;
            }
            renderIframeContent(currentTab); 

            try {
                const proxyUrl = `${GAS_URL}?url=${encodeURIComponent(url)}`;
                const response = await fetch(proxyUrl);
                const htmlContent = await response.text();

                if (!response.ok) {
                    throw new Error(`GASã‹ã‚‰ã‚¨ãƒ©ãƒ¼å¿œç­”: ${response.status} - ${htmlContent.substring(0, 100)}...`);
                }

                currentTab.content = htmlContent;
                
                // ãƒšãƒ¼ã‚¸å†…ã®ã‚ªãƒªã‚¸ãƒ³URLï¼ˆ<base href>ï¼‰ã‚’æŠ½å‡º
                let displayUrl = url; 
                const baseMatch = htmlContent.match(/<base\s+[^>]*href=["'](.*?)["'][^>]*>/i);
                if (baseMatch && baseMatch[1]) {
                    displayUrl = baseMatch[1].trim();
                }
                currentTab.displayUrl = displayUrl;

                // ã‚¿ã‚¤ãƒˆãƒ«æŠ½å‡º
                const titleMatch = htmlContent.match(/<title>(.*?)<\/title>/i);
                currentTab.title = titleMatch && titleMatch[1] ? titleMatch[1].trim() : new URL(displayUrl).hostname;
                currentTab.title = currentTab.title || 'ç„¡é¡Œã®ãƒšãƒ¼ã‚¸'; 
                
                // ãƒ•ã‚¡ãƒ“ã‚³ãƒ³æŠ½å‡º
                let faviconUrl = '';
                const linkMatch = htmlContent.match(/<link\s+[^>]*rel=["'](?:icon|shortcut icon)["'][^>]*href=["'](.*?)["'][^>]*>/i);
                if (linkMatch && linkMatch[1]) {
                    faviconUrl = linkMatch[1].trim();
                }

                if (faviconUrl) {
                    try {
                        const absoluteFaviconUrl = new URL(faviconUrl, displayUrl).href;
                        currentTab.favicon = `${GAS_URL}?url=${encodeURIComponent(absoluteFaviconUrl)}`;
                    } catch (e) {
                        const fallbackUrl = `${new URL(displayUrl).origin}/favicon.ico`;
                        currentTab.favicon = `${GAS_URL}?url=${encodeURIComponent(fallbackUrl)}`;
                    }
                } else {
                    const fallbackUrl = `${new URL(displayUrl).origin}/favicon.ico`;
                    currentTab.favicon = `${GAS_URL}?url=${encodeURIComponent(fallbackUrl)}`;
                }


                if (index === currentTabIndex) {
                    renderIframeContent(currentTab); 
                    addressBar.value = currentTab.displayUrl;
                    updateAddressBarIcon(currentTab.displayUrl);
                    updateSecurityMessage(currentTab.displayUrl, false); // ğŸŒŸ èª­ã¿è¾¼ã¿å®Œäº†å¾Œã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ›´æ–° ğŸŒŸ
                }

            } catch (error) {
                console.error("Fetch/Render Error:", error);
                
                let errorMessage = `ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚`;
                if (error.message.startsWith('GASã‹ã‚‰ã‚¨ãƒ©ãƒ¼å¿œç­”')) {
                    errorMessage += ' GASãƒ—ãƒ­ã‚­ã‚·ã®å®Ÿè¡Œãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';
                } else {
                     errorMessage += ` (${error.message})`;
                }

                currentTab.content = `<body style="padding: 20px; font-family: sans-serif; color: #dc2626; text-align: center;"><h1>${errorMessage}</h1><p>ãƒ–ãƒ©ã‚¦ã‚¶ã¨ã—ã¦æ­£ã—ãæ©Ÿèƒ½ã•ã›ã‚‹ã«ã¯ã€ã‚µãƒ¼ãƒãƒ¼å´ã®GASã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒHTMLå†…ã®å…¨ã¦ã®ç›¸å¯¾ãƒ‘ã‚¹ã‚„çµ¶å¯¾ãƒ‘ã‚¹ï¼ˆCSS, JS, ç”»åƒãªã©ï¼‰ã‚’ãƒ—ãƒ­ã‚­ã‚·URLã«æ›¸ãæ›ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p></body>`;
                currentTab.title = 'ã‚¨ãƒ©ãƒ¼';
                currentTab.favicon = '';
                currentTab.displayUrl = url; 

                if (index === currentTabIndex) {
                    renderIframeContent(currentTab);
                    addressBar.value = currentTab.displayUrl;
                    updateAddressBarIcon(currentTab.displayUrl);
                    
                    // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ã€è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä¸Šæ›¸ã
                    messageArea.className = 'flex-shrink-0 px-4 py-1 text-xs font-semibold text-red-700 bg-red-50 border-b border-red-300';
                    messageArea.textContent = `âŒ ${errorMessage}`;
                }

            } finally {
                currentTab.isLoading = false;
                renderTabs(); 
                if (index === currentTabIndex) {
                    goButton.disabled = false;
                    addressBar.disabled = false;
                    updateNavigationButtons();
                }
            }
        }
        async function fetchFavicon(url) {
    try {
        const u = new URL(url);

        // â–¼ 1. ãƒšãƒ¼ã‚¸ã®HTMLã‚’å–å¾—ã—ã¦ <link rel="icon"> ã‚’æ¢ã™
        const html = await fetch(u.href, { method: 'GET' }).then(r => r.text());
        const doc = new DOMParser().parseFromString(html, 'text/html');

        const selectors = [
            'link[rel="icon"]',
            'link[rel="shortcut icon"]',
            'link[rel="apple-touch-icon"]',
            'link[rel="apple-touch-icon-precomposed"]',
            'link[rel="mask-icon"]'
        ];

        for (const sel of selectors) {
            const el = doc.querySelector(sel);
            if (el && el.href) {
                // ç›¸å¯¾ãƒ‘ã‚¹ã‚’çµ¶å¯¾URLã«å¤‰æ›
                const iconUrl = new URL(el.getAttribute('href'), u.origin).href;
                return iconUrl;
            }
        }

        // â–¼ 2. è¦‹ã¤ã‹ã‚‰ãªã‘ã‚Œã° fallback
        return u.origin + '/favicon.ico';

    } catch (e) {
        return null;
    }
}

    </script>
</body>
</html>
